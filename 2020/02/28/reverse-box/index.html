<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://yoursite.com').hostname,
    root: '/',
    scheme: 'Muse',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="#reverse_box&lt;–more–&gt;1.main(): 123456789101112131415161718int __cdecl main(int a1, char **a2)&amp;#123;  size_t i; &#x2F;&#x2F; [esp+18h] [ebp-10Ch]  int v4; &#x2F;&#x2F; [esp+1Ch] [ebp-108h]  unsigned int v5; &#x2F;&#x2F; [esp+1">
<meta property="og:type" content="article">
<meta property="og:title" content="reverse_box">
<meta property="og:url" content="http://yoursite.com/2020/02/28/reverse-box/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="#reverse_box&lt;–more–&gt;1.main(): 123456789101112131415161718int __cdecl main(int a1, char **a2)&amp;#123;  size_t i; &#x2F;&#x2F; [esp+18h] [ebp-10Ch]  int v4; &#x2F;&#x2F; [esp+1Ch] [ebp-108h]  unsigned int v5; &#x2F;&#x2F; [esp+1">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-02-28T02:24:16.000Z">
<meta property="article:modified_time" content="2020-02-28T03:20:04.792Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/2020/02/28/reverse-box/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>reverse_box | Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/28/reverse-box/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          reverse_box
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-02-28 10:24:16 / Modified: 11:20:04" itemprop="dateCreated datePublished" datetime="2020-02-28T10:24:16+08:00">2020-02-28</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>#reverse_box<br>&lt;–more–&gt;<br>1.main():</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">char</span> **a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">size_t</span> i; <span class="comment">// [esp+18h] [ebp-10Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [esp+1Ch] [ebp-108h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v5; <span class="comment">// [esp+11Ch] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( a1 &lt;= <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"usage: %s flag\n"</span>, *a2);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  sub_804858D(&amp;v4);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(a2[<span class="number">1</span>]); ++i )</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%02x"</span>, *(&amp;v4 + a2[<span class="number">1</span>][i]));</span><br><span class="line">  <span class="built_in">putchar</span>(<span class="string">'\n'</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>题目需要输出”95eeaf95ef94234999582f722f492f72b19a7aaf72e6e776b57aee722fe77ab5ad9aaeb156729676ae7a236d99b1df4a”,猜测输出和输入有关。</p>
<p>2.sub_804858D()</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">sub_804858D</span><span class="params">(_BYTE *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v1; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// edx</span></span><br><span class="line">  <span class="keyword">char</span> v3; <span class="comment">// al</span></span><br><span class="line">  <span class="keyword">char</span> v4; <span class="comment">// ST1B_1</span></span><br><span class="line">  <span class="keyword">char</span> v5; <span class="comment">// al</span></span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v7; <span class="comment">// [esp+1Ah] [ebp-Eh]</span></span><br><span class="line">  <span class="keyword">char</span> v8; <span class="comment">// [esp+1Bh] [ebp-Dh]</span></span><br><span class="line">  <span class="keyword">char</span> v9; <span class="comment">// [esp+1Bh] [ebp-Dh]</span></span><br><span class="line">  <span class="keyword">int</span> v10; <span class="comment">// [esp+1Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v1 = time(<span class="number">0</span>);</span><br><span class="line">  srand(v1);</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">    v10 = rand();</span><br><span class="line">  <span class="keyword">while</span> ( !v10 );</span><br><span class="line">  *a1 = v10;</span><br><span class="line">  v7 = <span class="number">1</span>;</span><br><span class="line">  v8 = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v2 = v7 ^ <span class="number">2</span> * v7;                           </span><br><span class="line">    <span class="keyword">if</span> ( (v7 &amp; <span class="number">0x80</span>u) == <span class="number">0</span> )                    </span><br><span class="line">      v3 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v3 = <span class="number">27</span>;</span><br><span class="line">    v7 = v2 ^ v3;                               </span><br><span class="line">    v4 = <span class="number">4</span> * (<span class="number">2</span> * v8 ^ v8) ^ <span class="number">2</span> * v8 ^ v8;       </span><br><span class="line">    v9 = <span class="number">16</span> * v4 ^ v4;                          </span><br><span class="line">    <span class="keyword">if</span> ( v9 &gt;= <span class="number">0</span> )</span><br><span class="line">      v5 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v5 = <span class="number">9</span>;</span><br><span class="line">    v8 = v9 ^ v5;                               </span><br><span class="line">    result = __ROR1__(v8, <span class="number">4</span>) ^ __ROR1__(v8, <span class="number">5</span>) ^ __ROR1__(v8, <span class="number">6</span>) ^ __ROR1__(v8, <span class="number">7</span>) ^ (v8 ^ *a1);</span><br><span class="line">    a1[v7] = result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v7 != <span class="number">1</span> );</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此处函数生成一张数表。数表的生成值与时间有关。<br>汇编码:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.<span class="built_in">text</span>:<span class="number">080485</span>A7                 call    _rand</span><br><span class="line">.<span class="built_in">text</span>:<span class="number">080485</span>AC                 <span class="keyword">and</span>     eax, <span class="number">0F</span>Fh</span><br></pre></td></tr></table></figure>
<p>此处使得数表的第一个值有255种可能。</p>
<p>3.爆破出正确的数表。<br>gdb脚本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">set $i&#x3D;0</span><br><span class="line">set $total&#x3D;256</span><br><span class="line">while($i&lt;$total)</span><br><span class="line">  b *0x80485b4</span><br><span class="line">  b *0x8048704</span><br><span class="line">  run T</span><br><span class="line">  set $i&#x3D;$i+1</span><br><span class="line">  set *(char*)($ebp-0xc)&#x3D;$i</span><br><span class="line">  continue</span><br><span class="line">  if ($eax&#x3D;&#x3D;0x95)</span><br><span class="line">    print $i, $i</span><br><span class="line">    x&#x2F;256xb $esp+0x1c</span><br><span class="line">    set $i&#x3D;256</span><br><span class="line">  end</span><br><span class="line">  stop</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>使用方法：<br>1.define myfunc。<br>2.脚本。<br>3.myfunc。</p>
<p>4.得到flag:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a&#x3D;&quot;	0xd6	0xc9	0xc2	0xce	0x47	0xde	0xda	0x70	0x85	0xb4	0xd2	0x9e	0x4b	0x62	0x1e	0xc3	0x7f	0x37	0x7c	0xc8	0x4f	0xec	0xf2	0x45	0x18	0x61	0x17	0x1a	0x29	0x11	0xc7	0x75	0x02	0x48	0x26	0x93	0x83	0x8a	0x42	0x79	0x81	0x10	0x50	0x44	0xc4	0x6d	0x84	0xa0	0xb1	0x72	0x96	0x76	0xad	0x23	0xb0	0x2f	0xb2	0xa7	0x35	0x57	0x5e	0x92	0x07	0xc0	0xbc	0x36	0x99	0xaf	0xae	0xdb	0xef	0x15	0xe7	0x8e	0x63	0x06	0x9c	0x56	0x9a	0x31	0xe6	0x64	0xb5	0x58	0x95	0x49	0x04	0xee	0xdf	0x7e	0x0b	0x8c	0xff	0xf9	0xed	0x7a	0x65	0x5a	0x1f	0x4e	0xf6	0xf8	0x86	0x30	0xf0	0x4c	0xb7	0xca	0xe5	0x89	0x2a	0x1d	0xe4	0x16	0xf5	0x3a	0x27	0x28	0x8d	0x40	0x09	0x03	0x6f	0x94	0xa5	0x4a	0x46	0x67	0x78	0xb9	0xa6	0x59	0xea	0x22	0xf1	0xa2	0x71	0x12	0xcb	0x88	0xd1	0xe8	0xac	0xc6	0xd5	0x34	0xfa	0x69	0x97	0x9f	0x25	0x3d	0xf3	0x5b	0x0d	0xa1	0x6b	0xeb	0xbe	0x6e	0x55	0x87	0x8f	0xbf	0xfc	0xb3	0x91	0xe9	0x77	0x66	0x19	0xd7	0x24	0x20	0x51	0xcc	0x52	0x7d	0x82	0xd8	0x38	0x60	0xfb	0x1c	0xd9	0xe3	0x41	0x5f	0xd0	0xcf	0x1b	0xbd	0x0f	0xcd	0x90	0x9b	0xa9	0x13	0x01	0x73	0x5d	0x68	0xc1	0xaa	0xfe	0x08	0x3e	0x3f	0xc5	0x8b	0x00	0xd3	0xfd	0xb6	0x43	0xbb	0xd4	0x80	0xe2	0x0c	0x33	0x74	0xa8	0x2b	0x54	0x4d	0x2d	0xa4	0xdc	0x6c	0x3b	0x21	0x2e	0xab	0x32	0x5c	0x7b	0xe0	0x9d	0x6a	0x39	0x14	0x3c	0xb8	0x0a	0x53	0xf7	0xdd	0xf4	0x2c	0x98	0xba	0x05	0xe1	0x0e	0xa3&quot;</span><br><span class="line">a&#x3D;[int(a.split()[i],16) for i in range(len(a.split()))]</span><br><span class="line">b&#x3D;&quot;95eeaf95ef94234999582f722f492f72b19a7aaf72e6e776b57aee722fe77ab5ad9aaeb156729676ae7a236d99b1df4a&quot;</span><br><span class="line">b2&#x3D;bytearray.fromhex(b)</span><br><span class="line">b1&#x3D;list(b2)</span><br><span class="line">flag&#x3D;&#39;&#39;</span><br><span class="line">for i in b1:</span><br><span class="line">    flag+&#x3D;chr(a.index(i))</span><br><span class="line">print (flag)</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/02/23/just-reverse-it/" rel="prev" title="just_reverse_it">
      <i class="fa fa-chevron-left"></i> just_reverse_it
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">23</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.7.0
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
