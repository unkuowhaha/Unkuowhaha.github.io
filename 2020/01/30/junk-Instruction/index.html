<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://yoursite.com').hostname,
    root: '/',
    scheme: 'Muse',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="#junk_instruction">
<meta property="og:type" content="article">
<meta property="og:title" content="junk_Instruction">
<meta property="og:url" content="http://yoursite.com/2020/01/30/junk-Instruction/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="#junk_instruction">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-01-30T15:54:12.000Z">
<meta property="article:modified_time" content="2020-01-30T16:30:40.923Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/2020/01/30/junk-Instruction/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>junk_Instruction | Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/30/junk-Instruction/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          junk_Instruction
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-01-30 23:54:12" itemprop="dateCreated datePublished" datetime="2020-01-30T23:54:12+08:00">2020-01-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-01-31 00:30:40" itemprop="dateModified" datetime="2020-01-31T00:30:40+08:00">2020-01-31</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>#junk_instruction</p>
<a id="more"></a>
<p>1.打开程序，是一个需要输入flag值来判断的程序。</p>
<p>2.用ida打开程序，发现函数数量极多，而且都是未命名函数，难以分析。</p>
<p>3.用xspy工具查看提交按钮的函数。得到函数地址为基地址+0x002420。在ida中进入此函数。</p>
<p>4.函数如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __thiscall <span class="title">sub_3E2420</span><span class="params">(_DWORD *<span class="keyword">this</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _DWORD *v1; <span class="comment">// edi</span></span><br><span class="line">  <span class="keyword">char</span> v2; <span class="comment">// al</span></span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">void</span> ***v4; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">void</span> **v6; <span class="comment">// [esp+14h] [ebp-188h]</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// [esp+A8h] [ebp-F4h]</span></span><br><span class="line">  <span class="keyword">void</span> **v8; <span class="comment">// [esp+B4h] [ebp-E8h]</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// [esp+B8h] [ebp-E4h]</span></span><br><span class="line">  <span class="keyword">char</span> v10; <span class="comment">// [esp+C0h] [ebp-DCh]</span></span><br><span class="line">  <span class="keyword">void</span> **v11; <span class="comment">// [esp+CCh] [ebp-D0h]</span></span><br><span class="line">  <span class="keyword">int</span> v12; <span class="comment">// [esp+160h] [ebp-3Ch]</span></span><br><span class="line">  <span class="keyword">void</span> **v13; <span class="comment">// [esp+16Ch] [ebp-30h]</span></span><br><span class="line">  <span class="keyword">int</span> v14; <span class="comment">// [esp+170h] [ebp-2Ch]</span></span><br><span class="line">  <span class="keyword">char</span> v15; <span class="comment">// [esp+178h] [ebp-24h]</span></span><br><span class="line">  <span class="keyword">int</span> v16; <span class="comment">// [esp+198h] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  v1 = <span class="keyword">this</span>;</span><br><span class="line">  sub_3EC96E(<span class="keyword">this</span>, <span class="number">1</span>);</span><br><span class="line">  v2 = sub_3E3880((v1[<span class="number">47</span>] - <span class="number">16</span>));</span><br><span class="line">  <span class="keyword">if</span> ( sub_3E2600(v1, v2 + <span class="number">16</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    sub_3E1BF0(v3);</span><br><span class="line">    v7 = <span class="number">0</span>;</span><br><span class="line">    v9 = <span class="number">0</span>;</span><br><span class="line">    sub_3E3DC0(<span class="number">129</span>, <span class="number">0</span>);</span><br><span class="line">    sub_3E484E();</span><br><span class="line">    v6 = &amp;CCorrect::`vftable<span class="number">'</span>;</span><br><span class="line">    v16 = <span class="number">2</span>;</span><br><span class="line">    sub_3E7B3B(&amp;v10);</span><br><span class="line">    LOBYTE(v16) = <span class="number">1</span>;</span><br><span class="line">    v8 = &amp;CBrush::`vftable<span class="number">'</span>;</span><br><span class="line">    sub_3E1580(&amp;v8);</span><br><span class="line">    v4 = &amp;v6;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    sub_3E1BF0(v3);</span><br><span class="line">    v12 = <span class="number">0</span>;</span><br><span class="line">    v14 = <span class="number">0</span>;</span><br><span class="line">    sub_3E3DC0(<span class="number">130</span>, <span class="number">0</span>);</span><br><span class="line">    sub_3E484E();</span><br><span class="line">    v11 = &amp;CError::`vftable<span class="number">'</span>;</span><br><span class="line">    v16 = <span class="number">5</span>;</span><br><span class="line">    sub_3E7B3B(&amp;v15);</span><br><span class="line">    LOBYTE(v16) = <span class="number">4</span>;</span><br><span class="line">    v13 = &amp;CBrush::`vftable<span class="number">'</span>;</span><br><span class="line">    sub_3E1580(&amp;v13);</span><br><span class="line">    v4 = &amp;v11;</span><br><span class="line">  &#125;</span><br><span class="line">  v16 = <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">return</span> sub_3E434D(v4);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有一个if…else…结构，猜测分别对应正确和错误。跟进sub_3E2600函数。</p>
<p>5.函数如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span> __cdecl <span class="title">sub_402600</span><span class="params">(<span class="keyword">char</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">const</span> WCHAR *v2; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">void</span> *v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// [esp-10h] [ebp-4D4h]</span></span><br><span class="line">  <span class="keyword">char</span> v6; <span class="comment">// [esp+9h] [ebp-4BBh]</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// [esp+208h] [ebp-2BCh]</span></span><br><span class="line">  <span class="keyword">int</span> *v8; <span class="comment">// [esp+20Ch] [ebp-2B8h]</span></span><br><span class="line">  <span class="keyword">size_t</span> v9; <span class="comment">// [esp+214h] [ebp-2B0h]</span></span><br><span class="line">  <span class="keyword">int</span> v10; <span class="comment">// [esp+218h] [ebp-2ACh]</span></span><br><span class="line">  <span class="keyword">int</span> v11; <span class="comment">// [esp+21Ch] [ebp-2A8h]</span></span><br><span class="line">  <span class="keyword">char</span> *v12; <span class="comment">// [esp+224h] [ebp-2A0h]</span></span><br><span class="line">  <span class="keyword">int</span> v13; <span class="comment">// [esp+228h] [ebp-29Ch]</span></span><br><span class="line">  <span class="keyword">char</span> v14; <span class="comment">// [esp+22Ch] [ebp-298h]</span></span><br><span class="line">  <span class="keyword">char</span> *v15; <span class="comment">// [esp+230h] [ebp-294h]</span></span><br><span class="line">  <span class="keyword">int</span> v16; <span class="comment">// [esp+234h] [ebp-290h]</span></span><br><span class="line">  <span class="keyword">char</span> v17; <span class="comment">// [esp+238h] [ebp-28Ch]</span></span><br><span class="line">  <span class="keyword">char</span> v18; <span class="comment">// [esp+239h] [ebp-28Bh]</span></span><br><span class="line">  <span class="keyword">char</span> v19; <span class="comment">// [esp+23Ah] [ebp-28Ah]</span></span><br><span class="line">  <span class="keyword">char</span> v20; <span class="comment">// [esp+23Bh] [ebp-289h]</span></span><br><span class="line">  <span class="keyword">char</span> v21; <span class="comment">// [esp+23Ch] [ebp-288h]</span></span><br><span class="line">  <span class="keyword">char</span> v22; <span class="comment">// [esp+23Dh] [ebp-287h]</span></span><br><span class="line">  <span class="keyword">char</span> v23; <span class="comment">// [esp+23Eh] [ebp-286h]</span></span><br><span class="line">  <span class="keyword">char</span> v24; <span class="comment">// [esp+23Fh] [ebp-285h]</span></span><br><span class="line">  <span class="keyword">char</span> v25; <span class="comment">// [esp+240h] [ebp-284h]</span></span><br><span class="line">  <span class="keyword">char</span> v26; <span class="comment">// [esp+241h] [ebp-283h]</span></span><br><span class="line">  <span class="keyword">char</span> v27; <span class="comment">// [esp+242h] [ebp-282h]</span></span><br><span class="line">  <span class="keyword">char</span> v28; <span class="comment">// [esp+243h] [ebp-281h]</span></span><br><span class="line">  <span class="keyword">char</span> v29; <span class="comment">// [esp+244h] [ebp-280h]</span></span><br><span class="line">  <span class="keyword">char</span> v30; <span class="comment">// [esp+245h] [ebp-27Fh]</span></span><br><span class="line">  <span class="keyword">char</span> v31; <span class="comment">// [esp+246h] [ebp-27Eh]</span></span><br><span class="line">  <span class="keyword">char</span> v32; <span class="comment">// [esp+247h] [ebp-27Dh]</span></span><br><span class="line">  <span class="keyword">char</span> v33; <span class="comment">// [esp+248h] [ebp-27Ch]</span></span><br><span class="line">  <span class="keyword">char</span> v34; <span class="comment">// [esp+249h] [ebp-27Bh]</span></span><br><span class="line">  <span class="keyword">char</span> v35; <span class="comment">// [esp+24Ah] [ebp-27Ah]</span></span><br><span class="line">  <span class="keyword">char</span> v36; <span class="comment">// [esp+24Bh] [ebp-279h]</span></span><br><span class="line">  <span class="keyword">char</span> v37; <span class="comment">// [esp+24Ch] [ebp-278h]</span></span><br><span class="line">  <span class="keyword">char</span> v38; <span class="comment">// [esp+24Dh] [ebp-277h]</span></span><br><span class="line">  <span class="keyword">char</span> v39; <span class="comment">// [esp+24Eh] [ebp-276h]</span></span><br><span class="line">  <span class="keyword">char</span> v40; <span class="comment">// [esp+24Fh] [ebp-275h]</span></span><br><span class="line">  <span class="keyword">char</span> v41; <span class="comment">// [esp+250h] [ebp-274h]</span></span><br><span class="line">  <span class="keyword">char</span> v42; <span class="comment">// [esp+251h] [ebp-273h]</span></span><br><span class="line">  <span class="keyword">char</span> v43; <span class="comment">// [esp+252h] [ebp-272h]</span></span><br><span class="line">  <span class="keyword">char</span> v44; <span class="comment">// [esp+253h] [ebp-271h]</span></span><br><span class="line">  <span class="keyword">char</span> v45; <span class="comment">// [esp+254h] [ebp-270h]</span></span><br><span class="line">  <span class="keyword">char</span> v46; <span class="comment">// [esp+255h] [ebp-26Fh]</span></span><br><span class="line">  <span class="keyword">char</span> v47; <span class="comment">// [esp+256h] [ebp-26Eh]</span></span><br><span class="line">  <span class="keyword">char</span> v48; <span class="comment">// [esp+257h] [ebp-26Dh]</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *v49; <span class="comment">// [esp+258h] [ebp-26Ch]</span></span><br><span class="line">  <span class="keyword">char</span> *v50; <span class="comment">// [esp+25Ch] [ebp-268h]</span></span><br><span class="line">  <span class="keyword">char</span> v51; <span class="comment">// [esp+26Dh] [ebp-257h]</span></span><br><span class="line">  <span class="keyword">char</span> v52; <span class="comment">// [esp+26Eh] [ebp-256h]</span></span><br><span class="line">  <span class="keyword">char</span> v53; <span class="comment">// [esp+26Fh] [ebp-255h]</span></span><br><span class="line">  <span class="keyword">int</span> v54; <span class="comment">// [esp+270h] [ebp-254h]</span></span><br><span class="line">  <span class="keyword">int</span> v55; <span class="comment">// [esp+288h] [ebp-23Ch]</span></span><br><span class="line">  <span class="keyword">char</span> v56; <span class="comment">// [esp+28Ch] [ebp-238h]</span></span><br><span class="line">  <span class="keyword">char</span> v57; <span class="comment">// [esp+28Dh] [ebp-237h]</span></span><br><span class="line">  <span class="keyword">int</span> v58; <span class="comment">// [esp+38Ch] [ebp-138h]</span></span><br><span class="line">  <span class="keyword">int</span> v59; <span class="comment">// [esp+390h] [ebp-134h]</span></span><br><span class="line">  __int16 v60; <span class="comment">// [esp+394h] [ebp-130h]</span></span><br><span class="line">  <span class="keyword">char</span> v61; <span class="comment">// [esp+396h] [ebp-12Eh]</span></span><br><span class="line">  <span class="keyword">char</span> v62; <span class="comment">// [esp+397h] [ebp-12Dh]</span></span><br><span class="line">  <span class="keyword">char</span> v63; <span class="comment">// [esp+48Ch] [ebp-38h]</span></span><br><span class="line">  <span class="keyword">char</span> v64; <span class="comment">// [esp+48Dh] [ebp-37h]</span></span><br><span class="line">  <span class="keyword">int</span> v65; <span class="comment">// [esp+4C0h] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  v16 = v1;</span><br><span class="line">  v65 = <span class="number">0</span>;</span><br><span class="line">  v17 = <span class="number">91</span>;</span><br><span class="line">  v18 = <span class="number">-42</span>;</span><br><span class="line">  v19 = <span class="number">-48</span>;</span><br><span class="line">  v20 = <span class="number">38</span>;</span><br><span class="line">  v21 = <span class="number">-56</span>;</span><br><span class="line">  v22 = <span class="number">-35</span>;</span><br><span class="line">  v23 = <span class="number">25</span>;</span><br><span class="line">  v24 = <span class="number">126</span>;</span><br><span class="line">  v25 = <span class="number">110</span>;</span><br><span class="line">  v26 = <span class="number">62</span>;</span><br><span class="line">  v27 = <span class="number">-53</span>;</span><br><span class="line">  v28 = <span class="number">22</span>;</span><br><span class="line">  v29 = <span class="number">-111</span>;</span><br><span class="line">  v30 = <span class="number">125</span>;</span><br><span class="line">  v31 = <span class="number">-1</span>;</span><br><span class="line">  v32 = <span class="number">-81</span>;</span><br><span class="line">  v33 = <span class="number">-35</span>;</span><br><span class="line">  v34 = <span class="number">118</span>;</span><br><span class="line">  v35 = <span class="number">100</span>;</span><br><span class="line">  v36 = <span class="number">-80</span>;</span><br><span class="line">  v37 = <span class="number">-9</span>;</span><br><span class="line">  v38 = <span class="number">-27</span>;</span><br><span class="line">  v39 = <span class="number">-119</span>;</span><br><span class="line">  v40 = <span class="number">87</span>;</span><br><span class="line">  v41 = <span class="number">-126</span>;</span><br><span class="line">  v42 = <span class="number">-97</span>;</span><br><span class="line">  v43 = <span class="number">12</span>;</span><br><span class="line">  v44 = <span class="number">0</span>;</span><br><span class="line">  v45 = <span class="number">-98</span>;</span><br><span class="line">  v46 = <span class="number">-48</span>;</span><br><span class="line">  v47 = <span class="number">69</span>;</span><br><span class="line">  v48 = <span class="number">-6</span>;</span><br><span class="line">  v2 = (<span class="keyword">const</span> WCHAR *)sub_401570(&amp;a1);</span><br><span class="line">  v13 = sub_4030A0(v2);</span><br><span class="line">  v10 = v13;</span><br><span class="line">  LOBYTE(v65) = <span class="number">1</span>;</span><br><span class="line">  v3 = (<span class="keyword">void</span> *)sub_401570(v13);</span><br><span class="line">  sub_403000((<span class="keyword">int</span>)&amp;v54, v3);</span><br><span class="line">  LOBYTE(v65) = <span class="number">3</span>;</span><br><span class="line">  sub_4012A0(&amp;v14);</span><br><span class="line">  v15 = (<span class="keyword">char</span> *)unknown_libname_1(&amp;v54);</span><br><span class="line">  v50 = v15;</span><br><span class="line">  v12 = v15 + <span class="number">1</span>;</span><br><span class="line">  v50 += <span class="built_in">strlen</span>(v50);</span><br><span class="line">  v11 = ++v50 - (v15 + <span class="number">1</span>);</span><br><span class="line">  v9 = v50 - (v15 + <span class="number">1</span>);</span><br><span class="line">  v63 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(&amp;v64, <span class="number">0</span>, <span class="number">0x27</span>u);</span><br><span class="line">  <span class="built_in">strncpy</span>(&amp;v63, v15, v50 - (v15 + <span class="number">1</span>));</span><br><span class="line">  <span class="keyword">if</span> ( !sub_402AF0(&amp;v63) )</span><br><span class="line">  &#123;</span><br><span class="line">    v58 = <span class="number">1919252337</span>;</span><br><span class="line">    v59 = <span class="number">1769306484</span>;</span><br><span class="line">    v60 = <span class="number">28783</span>;</span><br><span class="line">    v61 = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">memset</span>(&amp;v62, <span class="number">0</span>, <span class="number">0xF5</span>u);</span><br><span class="line">    v56 = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">memset</span>(&amp;v57, <span class="number">0</span>, <span class="number">0xFF</span>u);</span><br><span class="line">    <span class="built_in">memset</span>(&amp;v6, <span class="number">0</span>, <span class="number">0x1FF</span>u);</span><br><span class="line">    v49 = (<span class="keyword">const</span> <span class="keyword">char</span> *)&amp;v58;</span><br><span class="line">    v8 = (<span class="keyword">int</span> *)((<span class="keyword">char</span> *)&amp;v58 + <span class="number">1</span>);</span><br><span class="line">    v49 += <span class="built_in">strlen</span>(v49);</span><br><span class="line">    v7 = ++v49 - ((<span class="keyword">const</span> <span class="keyword">char</span> *)&amp;v58 + <span class="number">1</span>);</span><br><span class="line">    sub_402CA0(&amp;v56);</span><br><span class="line">    v55 = <span class="number">4204868</span>;</span><br><span class="line">    JUMPOUT(__CS__, v5 + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  v51 = <span class="number">0</span>;</span><br><span class="line">  v53 = <span class="number">0</span>;</span><br><span class="line">  v52 = <span class="number">0</span>;</span><br><span class="line">  LOBYTE(v65) = <span class="number">0</span>;</span><br><span class="line">  sub_403060(&amp;v54);</span><br><span class="line">  v65 = <span class="number">-1</span>;</span><br><span class="line">  sub_4012A0(&amp;a1);</span><br><span class="line">  <span class="keyword">return</span> v52;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意到函数中有几处JUMPOUT()部分无法正常反汇编，通过其他wp得知是加了花指令导致反汇编失败。</p>
<p>6.用dbg动态调试程序去除花指令。<br>由ida汇编代码得知花指令:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">.<span class="built_in">text</span>:<span class="number">00402</span>A24                 call    $+<span class="number">5</span></span><br><span class="line">.<span class="built_in">text</span>:<span class="number">00402</span>A29                 pop     eax</span><br><span class="line">.<span class="built_in">text</span>:<span class="number">00402</span>A2A                 mov     [ebp+var_23C], eax</span><br><span class="line">.<span class="built_in">text</span>:<span class="number">00402</span>A30                 call    loc_402A38</span><br><span class="line">.<span class="built_in">text</span>:<span class="number">00402</span>A30 ; ---------------------------------------------------------------------------</span><br><span class="line">.<span class="built_in">text</span>:<span class="number">00402</span>A35                 db <span class="number">0</span>EAh, <span class="number">0</span>EBh, <span class="number">9</span></span><br><span class="line">.<span class="built_in">text</span>:<span class="number">00402</span>A38 ; ---------------------------------------------------------------------------</span><br><span class="line">.<span class="built_in">text</span>:<span class="number">00402</span>A38</span><br><span class="line">.<span class="built_in">text</span>:<span class="number">00402</span>A38 loc_402A38:                             ; CODE XREF: sub_402600+<span class="number">430</span>↑j</span><br><span class="line">.<span class="built_in">text</span>:<span class="number">00402</span>A38                 pop     ebx</span><br><span class="line">.<span class="built_in">text</span>:<span class="number">00402</span>A39                 inc     ebx</span><br><span class="line">.<span class="built_in">text</span>:<span class="number">00402</span>A3A                 push    ebx</span><br><span class="line">.<span class="built_in">text</span>:<span class="number">00402</span>A3B                 mov     eax, <span class="number">11111111</span>h</span><br><span class="line">.<span class="built_in">text</span>:<span class="number">00402</span>A40                 retn</span><br><span class="line">.<span class="built_in">text</span>:<span class="number">00402</span>A41 ; ---------------------------------------------------------------------------</span><br><span class="line">.<span class="built_in">text</span>:<span class="number">00402</span>A41                 call    loc_402A4D</span><br><span class="line">.<span class="built_in">text</span>:<span class="number">00402</span>A46                 mov     ebx, <span class="number">33333333</span>h</span><br></pre></td></tr></table></figure>
<p>花指令均用nop指令填充。</p>
<p>7.去花后的函数：</p>
<figure class="highlight plain"><figcaption><span>__thiscall sub_3E2600(void *this, char a2)</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  const WCHAR *v2; &#x2F;&#x2F; eax</span><br><span class="line">  void *v3; &#x2F;&#x2F; eax</span><br><span class="line">  char v5; &#x2F;&#x2F; [esp+9h] [ebp-4BBh]</span><br><span class="line">  int v6; &#x2F;&#x2F; [esp+208h] [ebp-2BCh]</span><br><span class="line">  int *v7; &#x2F;&#x2F; [esp+20Ch] [ebp-2B8h]</span><br><span class="line">  int v8; &#x2F;&#x2F; [esp+210h] [ebp-2B4h]</span><br><span class="line">  size_t v9; &#x2F;&#x2F; [esp+214h] [ebp-2B0h]</span><br><span class="line">  _DWORD *v10; &#x2F;&#x2F; [esp+218h] [ebp-2ACh]</span><br><span class="line">  int v11; &#x2F;&#x2F; [esp+21Ch] [ebp-2A8h]</span><br><span class="line">  char *v12; &#x2F;&#x2F; [esp+220h] [ebp-2A4h]</span><br><span class="line">  char *v13; &#x2F;&#x2F; [esp+224h] [ebp-2A0h]</span><br><span class="line">  _DWORD *v14; &#x2F;&#x2F; [esp+228h] [ebp-29Ch]</span><br><span class="line">  char v15; &#x2F;&#x2F; [esp+22Ch] [ebp-298h]</span><br><span class="line">  char *v16; &#x2F;&#x2F; [esp+230h] [ebp-294h]</span><br><span class="line">  void *v17; &#x2F;&#x2F; [esp+234h] [ebp-290h]</span><br><span class="line">  char v18; &#x2F;&#x2F; [esp+238h] [ebp-28Ch]</span><br><span class="line">  char v19; &#x2F;&#x2F; [esp+239h] [ebp-28Bh]</span><br><span class="line">  char v20; &#x2F;&#x2F; [esp+23Ah] [ebp-28Ah]</span><br><span class="line">  char v21; &#x2F;&#x2F; [esp+23Bh] [ebp-289h]</span><br><span class="line">  char v22; &#x2F;&#x2F; [esp+23Ch] [ebp-288h]</span><br><span class="line">  char v23; &#x2F;&#x2F; [esp+23Dh] [ebp-287h]</span><br><span class="line">  char v24; &#x2F;&#x2F; [esp+23Eh] [ebp-286h]</span><br><span class="line">  char v25; &#x2F;&#x2F; [esp+23Fh] [ebp-285h]</span><br><span class="line">  char v26; &#x2F;&#x2F; [esp+240h] [ebp-284h]</span><br><span class="line">  char v27; &#x2F;&#x2F; [esp+241h] [ebp-283h]</span><br><span class="line">  char v28; &#x2F;&#x2F; [esp+242h] [ebp-282h]</span><br><span class="line">  char v29; &#x2F;&#x2F; [esp+243h] [ebp-281h]</span><br><span class="line">  char v30; &#x2F;&#x2F; [esp+244h] [ebp-280h]</span><br><span class="line">  char v31; &#x2F;&#x2F; [esp+245h] [ebp-27Fh]</span><br><span class="line">  char v32; &#x2F;&#x2F; [esp+246h] [ebp-27Eh]</span><br><span class="line">  char v33; &#x2F;&#x2F; [esp+247h] [ebp-27Dh]</span><br><span class="line">  char v34; &#x2F;&#x2F; [esp+248h] [ebp-27Ch]</span><br><span class="line">  char v35; &#x2F;&#x2F; [esp+249h] [ebp-27Bh]</span><br><span class="line">  char v36; &#x2F;&#x2F; [esp+24Ah] [ebp-27Ah]</span><br><span class="line">  char v37; &#x2F;&#x2F; [esp+24Bh] [ebp-279h]</span><br><span class="line">  char v38; &#x2F;&#x2F; [esp+24Ch] [ebp-278h]</span><br><span class="line">  char v39; &#x2F;&#x2F; [esp+24Dh] [ebp-277h]</span><br><span class="line">  char v40; &#x2F;&#x2F; [esp+24Eh] [ebp-276h]</span><br><span class="line">  char v41; &#x2F;&#x2F; [esp+24Fh] [ebp-275h]</span><br><span class="line">  char v42; &#x2F;&#x2F; [esp+250h] [ebp-274h]</span><br><span class="line">  char v43; &#x2F;&#x2F; [esp+251h] [ebp-273h]</span><br><span class="line">  char v44; &#x2F;&#x2F; [esp+252h] [ebp-272h]</span><br><span class="line">  char v45; &#x2F;&#x2F; [esp+253h] [ebp-271h]</span><br><span class="line">  char v46; &#x2F;&#x2F; [esp+254h] [ebp-270h]</span><br><span class="line">  char v47; &#x2F;&#x2F; [esp+255h] [ebp-26Fh]</span><br><span class="line">  char v48; &#x2F;&#x2F; [esp+256h] [ebp-26Eh]</span><br><span class="line">  char v49; &#x2F;&#x2F; [esp+257h] [ebp-26Dh]</span><br><span class="line">  const char *v50; &#x2F;&#x2F; [esp+258h] [ebp-26Ch]</span><br><span class="line">  char *v51; &#x2F;&#x2F; [esp+25Ch] [ebp-268h]</span><br><span class="line">  int i; &#x2F;&#x2F; [esp+260h] [ebp-264h]</span><br><span class="line">  char *v53; &#x2F;&#x2F; [esp+264h] [ebp-260h]</span><br><span class="line">  char v54; &#x2F;&#x2F; [esp+26Dh] [ebp-257h]</span><br><span class="line">  char v55; &#x2F;&#x2F; [esp+26Eh] [ebp-256h]</span><br><span class="line">  char v56; &#x2F;&#x2F; [esp+26Fh] [ebp-255h]</span><br><span class="line">  int v57; &#x2F;&#x2F; [esp+270h] [ebp-254h]</span><br><span class="line">  char v58; &#x2F;&#x2F; [esp+28Ch] [ebp-238h]</span><br><span class="line">  char v59; &#x2F;&#x2F; [esp+28Dh] [ebp-237h]</span><br><span class="line">  int v60; &#x2F;&#x2F; [esp+38Ch] [ebp-138h]</span><br><span class="line">  int v61; &#x2F;&#x2F; [esp+390h] [ebp-134h]</span><br><span class="line">  __int16 v62; &#x2F;&#x2F; [esp+394h] [ebp-130h]</span><br><span class="line">  char v63; &#x2F;&#x2F; [esp+396h] [ebp-12Eh]</span><br><span class="line">  char v64; &#x2F;&#x2F; [esp+397h] [ebp-12Dh]</span><br><span class="line">  char v65; &#x2F;&#x2F; [esp+48Ch] [ebp-38h]</span><br><span class="line">  char v66; &#x2F;&#x2F; [esp+48Dh] [ebp-37h]</span><br><span class="line">  int v67; &#x2F;&#x2F; [esp+4C0h] [ebp-4h]</span><br><span class="line"></span><br><span class="line">  v17 &#x3D; this;</span><br><span class="line">  v67 &#x3D; 0;</span><br><span class="line">  v18 &#x3D; 91;</span><br><span class="line">  v19 &#x3D; 214;</span><br><span class="line">  v20 &#x3D; 208;</span><br><span class="line">  v21 &#x3D; 38;</span><br><span class="line">  v22 &#x3D; 200;</span><br><span class="line">  v23 &#x3D; 221;</span><br><span class="line">  v24 &#x3D; 25;</span><br><span class="line">  v25 &#x3D; 126;</span><br><span class="line">  v26 &#x3D; 110;</span><br><span class="line">  v27 &#x3D; 62;</span><br><span class="line">  v28 &#x3D; 203;</span><br><span class="line">  v29 &#x3D; 22;</span><br><span class="line">  v30 &#x3D; 145;</span><br><span class="line">  v31 &#x3D; 125;</span><br><span class="line">  v32 &#x3D; 255;</span><br><span class="line">  v33 &#x3D; 175;</span><br><span class="line">  v34 &#x3D; 221;</span><br><span class="line">  v35 &#x3D; 118;</span><br><span class="line">  v36 &#x3D; 100;</span><br><span class="line">  v37 &#x3D; -80;</span><br><span class="line">  v38 &#x3D; -9;</span><br><span class="line">  v39 &#x3D; -27;</span><br><span class="line">  v40 &#x3D; -119;</span><br><span class="line">  v41 &#x3D; 87;</span><br><span class="line">  v42 &#x3D; -126;</span><br><span class="line">  v43 &#x3D; -97;</span><br><span class="line">  v44 &#x3D; 12;</span><br><span class="line">  v45 &#x3D; 0;</span><br><span class="line">  v46 &#x3D; -98;</span><br><span class="line">  v47 &#x3D; -48;</span><br><span class="line">  v48 &#x3D; 69;</span><br><span class="line">  v49 &#x3D; 250;</span><br><span class="line">  v2 &#x3D; sub_3E1570(&amp;a2);</span><br><span class="line">  v14 &#x3D; sub_3E30A0(&amp;v15, v2);</span><br><span class="line">  v10 &#x3D; v14;</span><br><span class="line">  LOBYTE(v67) &#x3D; 1;</span><br><span class="line">  v3 &#x3D; sub_3E1570(v14);</span><br><span class="line">  sub_3E3000(&amp;v57, v3);</span><br><span class="line">  LOBYTE(v67) &#x3D; 3;</span><br><span class="line">  sub_3E12A0(&amp;v15);</span><br><span class="line">  v16 &#x3D; unknown_libname_1(&amp;v57);</span><br><span class="line">  v51 &#x3D; v16;</span><br><span class="line">  v13 &#x3D; v16 + 1;</span><br><span class="line">  v51 +&#x3D; strlen(v51);</span><br><span class="line">  v11 &#x3D; ++v51 - (v16 + 1);</span><br><span class="line">  v9 &#x3D; v51 - (v16 + 1);</span><br><span class="line">  v65 &#x3D; 0;</span><br><span class="line">  memset(&amp;v66, 0, 0x27u);</span><br><span class="line">  strncpy(&amp;v65, v16, v51 - (v16 + 1));</span><br><span class="line">  if ( sub_3E2AF0(&amp;v65) )                       &#x2F;&#x2F; 判断长度和逆序</span><br><span class="line">  &#123;</span><br><span class="line">    v54 &#x3D; 0;</span><br><span class="line">    v56 &#x3D; 0;</span><br><span class="line">LABEL_7:</span><br><span class="line">    v55 &#x3D; v56;</span><br><span class="line">  &#125;</span><br><span class="line">  else                                          &#x2F;&#x2F; rc4加密</span><br><span class="line">  &#123;</span><br><span class="line">    v60 &#x3D; &#39;rewq&#39;;                               &#x2F;&#x2F; rewqiuytpo</span><br><span class="line">    v61 &#x3D; &#39;iuyt&#39;;</span><br><span class="line">    v62 &#x3D; &#39;po&#39;;</span><br><span class="line">    v63 &#x3D; 0;</span><br><span class="line">    memset(&amp;v64, 0, 0xF5u);</span><br><span class="line">    v58 &#x3D; 0;</span><br><span class="line">    memset(&amp;v59, 0, 0xFFu);</span><br><span class="line">    memset(&amp;v5, 0, 0x1FFu);</span><br><span class="line">    v50 &#x3D; &amp;v60;</span><br><span class="line">    v7 &#x3D; (&amp;v60 + 1);</span><br><span class="line">    v50 +&#x3D; strlen(v50);                         &#x2F;&#x2F; 11</span><br><span class="line">    v6 &#x3D; ++v50 - (&amp;v60 + 1);</span><br><span class="line">    sub_3E2CA0(&amp;v58, &amp;v60, v50 - (&amp;v60 + 1));</span><br><span class="line">    v53 &#x3D; &amp;v65;</span><br><span class="line">    v12 &#x3D; &amp;v66;</span><br><span class="line">    v53 +&#x3D; strlen(v53);</span><br><span class="line">    v8 &#x3D; ++v53 - &amp;v66;</span><br><span class="line">    sub_3E2E80(&amp;v58, &amp;v65, v53 - &amp;v66);         &#x2F;&#x2F; 对输入进行加密</span><br><span class="line">    for ( i &#x3D; 31; i &gt;&#x3D; 0; --i )</span><br><span class="line">    &#123;</span><br><span class="line">      if ( *(&amp;v65 + i) !&#x3D; *(&amp;v18 + i) )         &#x2F;&#x2F; 数组对比</span><br><span class="line">      &#123;</span><br><span class="line">        v56 &#x3D; 0;</span><br><span class="line">        goto LABEL_7;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    v55 &#x3D; 1;</span><br><span class="line">  &#125;</span><br><span class="line">  LOBYTE(v67) &#x3D; 0;</span><br><span class="line">  sub_3E3060(&amp;v57);</span><br><span class="line">  v67 &#x3D; -1;</span><br><span class="line">  sub_3E12A0(&amp;a2);</span><br><span class="line">  return v55;                                   &#x2F;&#x2F; 需要函数返回值为一</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>8.经过代码分析可以得知，输入长度要等于38。并且函数对输入进行了逆序操作，再进行了rc4加密操作，最后把加密得到的字符串与已有字符串比较。</p>
<p>9.加密函数：<br>part1:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> *__stdcall <span class="title">sub_3E2CA0</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">void</span> *a2, <span class="keyword">unsigned</span> <span class="keyword">int</span> a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">void</span> *result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> v4; <span class="comment">// ST1B_1</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// [esp+8h] [ebp-114h]</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// [esp+10h] [ebp-10Ch]</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> j; <span class="comment">// [esp+10h] [ebp-10Ch]</span></span><br><span class="line">  <span class="keyword">char</span> v8; <span class="comment">// [esp+18h] [ebp-104h]</span></span><br><span class="line">  <span class="keyword">char</span> v9; <span class="comment">// [esp+19h] [ebp-103h]</span></span><br><span class="line"></span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  v8 = <span class="number">0</span>;</span><br><span class="line">  result = <span class="built_in">memset</span>(&amp;v9, <span class="number">0</span>, <span class="number">0xFF</span>u);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">256</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    *(i + a1) = i;</span><br><span class="line">    result = a2;</span><br><span class="line">    *(&amp;v8 + i) = *(a2 + i % a3);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">256</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 = (*(&amp;v8 + j) + v5 + *(j + a1)) % <span class="number">256</span>;</span><br><span class="line">    v4 = *(j + a1);</span><br><span class="line">    *(j + a1) = *(v5 + a1);</span><br><span class="line">    *(v5 + a1) = v4;</span><br><span class="line">    result = (j + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>part2:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __stdcall <span class="title">sub_3E2E80</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">int</span> a2, <span class="keyword">unsigned</span> <span class="keyword">int</span> a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> v4; <span class="comment">// ST1B_1</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// [esp+Ch] [ebp-18h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> i; <span class="comment">// [esp+10h] [ebp-14h]</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// [esp+14h] [ebp-10h]</span></span><br><span class="line"></span><br><span class="line">  v7 = <span class="number">0</span>;</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; a3; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v7 = (v7 + <span class="number">1</span>) % <span class="number">256</span>;</span><br><span class="line">    v5 = (v5 + *(v7 + a1)) % <span class="number">256</span>;</span><br><span class="line">    v4 = *(v7 + a1);</span><br><span class="line">    *(v7 + a1) = *(v5 + a1);</span><br><span class="line">    *(v5 + a1) = v4;</span><br><span class="line">    *(i + a2) ^= *((*(v5 + a1) + *(v7 + a1)) % <span class="number">256</span> + a1);</span><br><span class="line">    result = i + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>10.脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">d &#x3D; [0x5B, 0xD6, 0xD0, 0x26, 0xC8, 0xDD, 0x19, 126, 110, 62, -53, 22, -111, 125, -1, -81, -35, 118, 100, -80, -9, -27, -119, 87, -126, -97, 12, 0, -98, -48, 69, -6]</span><br><span class="line">import sys, os, hashlib, time, base64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def rc4(plain, key):</span><br><span class="line">    box &#x3D; list(range(256))</span><br><span class="line">    j &#x3D; 0</span><br><span class="line">    for i in range(256):</span><br><span class="line">        j &#x3D; (j + box[i] + ord(key[i % len(key)])) % 256</span><br><span class="line">        box[i], box[j] &#x3D; box[j], box[i]</span><br><span class="line">    print(box)</span><br><span class="line">    # print(type(box)) #for_test</span><br><span class="line">    # return box</span><br><span class="line">    res &#x3D; []</span><br><span class="line">    i &#x3D; j &#x3D; 0</span><br><span class="line">    for s in plain:</span><br><span class="line">        i &#x3D; (i + 1) % 256</span><br><span class="line">        j &#x3D; (j + box[i]) % 256</span><br><span class="line">        box[i], box[j] &#x3D; box[j], box[i]</span><br><span class="line">        t &#x3D; (box[i] + box[j]) % 256</span><br><span class="line">        k &#x3D; box[t]</span><br><span class="line">        res.append(chr((s ^ k)&amp;0xff))</span><br><span class="line">    return res</span><br><span class="line"></span><br><span class="line">r &#x3D; rc4(d, &quot;qwertyuiop&quot;)</span><br><span class="line">r &#x3D; [(i) for i in r]</span><br><span class="line">print(&quot;&quot;.join(r[::-1]))</span><br></pre></td></tr></table></figure>
<p>只能先贴一位大神的。</p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/01/29/replace/" rel="prev" title="replace">
      <i class="fa fa-chevron-left"></i> replace
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/02/02/libdroid/" rel="next" title="libdroid">
      libdroid <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">18</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.7.0
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
